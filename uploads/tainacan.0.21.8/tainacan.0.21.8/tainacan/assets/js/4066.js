"use strict";(self.webpackChunktainacan=self.webpackChunktainacan||[]).push([[4066,1685],{49515:(t,e,a)=>{a.d(e,{A:()=>o});var i=a(75552),n=a(8926);const o={directives:{imask:a(30554).Zq},mixins:[n.F],props:{itemMetadatum:Object,value:[String,Number,Array],disabled:!1},emits:["update:value","blur","mobile-special-focus"],data:function(){return{selected:"",options:[],label:"",searchQuery:"",searchOffset:0,searchNumber:12,totalFacets:0,query:"",currentCollectionId:"",filter:void 0,isInputFocused:!1}},computed:{getDisplayAutocomplete:function(){return!!(this.itemMetadatum&&this.itemMetadatum.metadatum.metadata_type_options&&this.itemMetadatum.metadatum.metadata_type_options.display_suggestions)&&"yes"==this.itemMetadatum.metadatum.metadata_type_options.display_suggestions},getMask:function(){return!!(this.itemMetadatum&&this.itemMetadatum.metadatum.metadata_type_options&&this.itemMetadatum.metadatum.metadata_type_options.mask)&&{mask:this.itemMetadatum.metadatum.metadata_type_options.mask,lazy:!1}},getMaxlength:function(){return this.itemMetadatum&&this.itemMetadatum.metadatum.metadata_type_options&&null!==this.itemMetadatum.metadatum.metadata_type_options.maxlength&&void 0!==this.itemMetadatum.metadatum.metadata_type_options.maxlength&&""!==this.itemMetadatum.metadatum.metadata_type_options.maxlength?Number(this.itemMetadatum.metadatum.metadata_type_options.maxlength):void 0}},created:function(){this.currentCollectionId=this.itemMetadatum&&this.itemMetadatum.metadatum&&this.itemMetadatum.metadatum.collection_id?this.itemMetadatum.metadatum.collection_id:null,this.filter={collection_id:this.currentCollectionId}},methods:{onInput:function(t){var e=this.$refs["tainacan-item-metadatum_id-"+this.itemMetadatum.metadatum.id+(this.itemMetadatum.parent_meta_id?"_parent_meta_id-"+this.itemMetadatum.parent_meta_id:"")];e&&this.getMaxlength&&!e.checkHtml5Validity()||this.$emit("update:value",t)},onBlur:function(){this.isInputFocused=!1,this.$emit("blur")},onSelect:function(t){t&&(this.selected=t.value,this.label=t.label,this.onInput(this.label))},search:_.debounce((function(t){var e=this;if(t!=this.searchQuery&&(this.searchQuery=t,this.options=[],this.searchOffset=0),this.onInput(t),t.length||(this.searchQuery=t,this.options=[],this.searchOffset=0),!(this.searchOffset>0&&this.options.length>=this.totalFacets))if(""!=this.searchQuery){var a=null;null!=this.getOptionsValuesCancel&&this.getOptionsValuesCancel.cancel("Facet search Canceled."),(a=this.getValuesPlainText({metadatumId:this.itemMetadatum.metadatum.id,search:this.searchQuery,isRepositoryLevel:"default"==this.currentCollectionId,valuesToIgnore:[],offset:this.searchOffset,number:this.searchNumber,isInCheckboxModal:!1,countItems:!1})).request.then((function(t){e.totalFacets=t.headers["x-wp-total"],e.searchOffset+=e.searchNumber})).catch((function(t){(0,i.FZ)(t)?e.$console.log("Request canceled: "+t.message):e.$console.error(t)})),this.getOptionsValuesCancel=a.source}else this.label="",this.selected=""}),500),searchMore:_.debounce((function(){this.shouldAddOptions=!0,this.search(this.searchQuery)}),250),onMobileSpecialFocus:function(){this.isInputFocused=!0,this.$emit("mobile-special-focus")}}}},36054:(t,e,a)=>{a.d(e,{X:()=>u});var i=a(6934),n={key:0,class:"control is-clearfix"},o=["id","disabled","value","placeholder","maxlength"],s={key:0},l={class:"media"},r={class:"media-content"},c={class:"ellipsed-text"};function u(t,e,a,u,m,h){var d=(0,i.g2)("b-autocomplete"),p=(0,i.gN)("imask");return(0,i.uX)(),(0,i.CE)("div",null,[h.getDisplayAutocomplete?((0,i.uX)(),(0,i.Wv)(d,{key:1,id:"tainacan-item-metadatum_id-"+a.itemMetadatum.metadatum.id+(a.itemMetadatum.parent_meta_id?"_parent_meta_id-"+a.itemMetadatum.parent_meta_id:""),disabled:a.disabled,"model-value":a.value,data:m.options,loading:t.isLoadingOptions,field:"label",clearable:"",placeholder:a.itemMetadatum.metadatum.placeholder?a.itemMetadatum.metadatum.placeholder:"","check-infinite-scroll":"",maxlength:h.getMaxlength,onBlur:h.onBlur,"onUpdate:modelValue":e[4]||(e[4]=function(t){h.search(t)}),onSelect:h.onSelect,onInfiniteScroll:h.searchMore,onFocus:h.onMobileSpecialFocus},{header:(0,i.k6)((function(){return[!t.isLoadingOptions&&m.options&&m.options.length?((0,i.uX)(),(0,i.CE)("span",s,(0,i.v_)(t.$i18n.get("info_metadata_autocomplete_suggestions")),1)):(0,i.Q3)("",!0)]})),default:(0,i.k6)((function(t){return[(0,i.Lk)("div",l,[(0,i.Lk)("div",r,[(0,i.Lk)("span",c,(0,i.v_)(t.option.label),1)])])]})),empty:(0,i.k6)((function(){return[(0,i.eW)((0,i.v_)(t.$i18n.get("info_nothing_like_this_so_far")),1)]})),_:1},8,["id","disabled","model-value","data","loading","placeholder","maxlength","onBlur","onSelect","onInfiniteScroll","onFocus"])):((0,i.uX)(),(0,i.CE)("div",n,[(0,i.bo)((0,i.Lk)("input",{id:"tainacan-item-metadatum_id-"+a.itemMetadatum.metadatum.id+(a.itemMetadatum.parent_meta_id?"_parent_meta_id-"+a.itemMetadatum.parent_meta_id:""),class:"input",disabled:a.disabled,value:a.value,placeholder:a.itemMetadatum.metadatum.placeholder?a.itemMetadatum.metadatum.placeholder:"",maxlength:h.getMaxlength,onFocus:e[0]||(e[0]=function(){return h.onMobileSpecialFocus&&h.onMobileSpecialFocus.apply(h,arguments)}),onComplete:e[1]||(e[1]=function(t){return h.getMask?h.onInput(t.detail.value):null}),onInput:e[2]||(e[2]=function(t){return h.getMask?null:h.onInput(t.target.value)}),onBlur:e[3]||(e[3]=function(){return h.onBlur&&h.onBlur.apply(h,arguments)})},null,40,o),[[p,h.getMask]]),h.getMaxlength?((0,i.uX)(),(0,i.CE)("small",{key:0,class:(0,i.C4)(["help counter",{"is-invisible":!m.isInputFocused}])},(0,i.v_)(a.value.length)+" / "+(0,i.v_)(h.getMaxlength),3)):(0,i.Q3)("",!0)]))])}},8926:(t,e,a)=>{a.d(e,{F:()=>d,s:()=>h});var i=a(55373),n=a.n(i),o=a(75552),s=a(40834);function l(t){return l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},l(t)}function r(t,e){var a="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!a){if(Array.isArray(t)||(a=function(t,e){if(t){if("string"==typeof t)return c(t,e);var a={}.toString.call(t).slice(8,-1);return"Object"===a&&t.constructor&&(a=t.constructor.name),"Map"===a||"Set"===a?Array.from(t):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?c(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){a&&(t=a);var _n=0,i=function(){};return{s:i,n:function(){return _n>=t.length?{done:!0}:{done:!1,value:t[_n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,o=!0,s=!1;return{s:function(){a=a.call(t)},n:function(){var t=a.next();return o=t.done,t},e:function(t){s=!0,n=t},f:function(){try{o||null==a.return||a.return()}finally{if(s)throw n}}}}function c(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,i=Array(e);a<e;a++)i[a]=t[a];return i}function u(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,i)}return a}function m(t,e,a){return(e=function(t){var e=function(t,e){if("object"!=l(t)||!t)return t;var a=t[Symbol.toPrimitive];if(void 0!==a){var i=a.call(t,e||"default");if("object"!=l(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==l(e)?e:e+""}(e))in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}var h={data:function(){return{collectionId:"",metadatumId:"",metadatumType:"",metadatumName:"",filterTypeOptions:[],shouldAddOptions:!1}},props:{filter:Object,query:Object,isRepositoryLevel:Boolean,isUsingElasticSearch:Boolean,isLoadingItems:Boolean,currentCollectionId:[Number,String]},created:function(){this.collectionId=this.filter.collection_id?this.filter.collection_id:this.collectionId,this.metadatumId=this.filter.metadatum.metadatum_id?this.filter.metadatum.metadatum_id:this.metadatumId,this.metadatumName=this.filter.metadatum&&this.filter.metadatum.metadatum_name?this.filter.metadatum.metadatum_name:this.metadatumName,this.filterTypeOptions=this.filter.filter_type_options?this.filter.filter_type_options:this.filterTypeOptions,this.metadatumType=this.filter.metadatum.metadata_type_object&&this.filter.metadatum.metadata_type_object.className?this.filter.metadatum.metadata_type_object.className:this.metadatumType},methods:{resetPage:function(){this.$eventBusSearch.resetPageOnStore()}}},d={data:function(){return{getOptionsValuesCancel:void 0,isLoadingOptions:!1,facetSearchPage:1}},emits:["update-parent-collapse"],computed:function(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?u(Object(a),!0).forEach((function(e){m(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):u(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}({},(0,s.L8)("search",{facetsFromItemSearch:"getFacets"})),watch:{isLoadingItems:{handler:function(){this.isUsingElasticSearch&&(this.isLoadingOptions=this.isLoadingItems)},immediate:!0}},methods:{getValuesPlainText:function(t){var e=this,a=t.metadatumId,i=t.search,s=t.isRepositoryLevel,l=t.valuesToIgnore,r=t.offset,c=t.number,u=t.isInCheckboxModal,m=t.getSelected,h=void 0===m?"0":m,d=t.countItems,p=void 0===d||d;if(u||i||!this.isUsingElasticSearch){var f=o.Ay.CancelToken.source(),g=JSON.parse(JSON.stringify(this.query));null!=g.fetch_only&&delete g.fetch_only;var _={current_query:g},b="";return b=s?"/facets/".concat(a,"?getSelected=").concat(h,"&"):"default"==this.filter.collection_id&&this.currentCollectionId?"/collection/".concat(this.currentCollectionId,"/facets/").concat(a,"?getSelected=").concat(h,"&"):"/collection/".concat(this.filter.collection_id,"/facets/").concat(a,"?getSelected=").concat(h,"&"),null!=r&&null!=c&&(this.isUsingElasticSearch?b+="last_term=".concat(r,"&number=").concat(c,"&"):b+="offset=".concat(r,"&number=").concat(c,"&")),b+=i&&null!=r&&null!=c||i?"search=".concat(i,"&")+n().stringify(_):n().stringify(_),null!=p&&!1===p&&(b+="&count_items=0"),this.isLoadingOptions=!0,new Object({request:new Promise((function(t,a){o.Ay.tainacanApi.get(b,{cancelToken:f.token}).then((function(a){e.isLoadingOptions=!1,a.data.values?e.prepareOptionsForPlainText(a.data.values,i,l,u):e.prepareOptionsForPlainText(a.data,i,l,u),t(a)})).catch((function(t){o.Ay.isCancel(t)?console.log("Request canceled: ",t.message):e.isLoadingOptions=!1,a(t)}))})),source:f})}var v=new Promise((function(t){for(var a in e.facetsFromItemSearch)a==e.filter.id&&(e.prepareOptionsForPlainText(e.facetsFromItemSearch[a],i,l,u),e.$emit("update-parent-collapse",e.facetsFromItemSearch[a].length>0));t()}));return new Object({request:v})},getValuesRelationship:function(t){var e=this,a=t.search,i=t.isRepositoryLevel,s=t.valuesToIgnore,l=t.offset,r=t.number,c=t.isInCheckboxModal,u=t.getSelected,m=void 0===u?"0":u,h=t.countItems,d=void 0===h||h;if(c||a||!this.facetsFromItemSearch||Object.values(this.facetsFromItemSearch).length<=0){var p=o.Ay.CancelToken.source(),f=JSON.parse(JSON.stringify(this.query));null!=f.fetch_only&&delete f.fetch_only;var g={current_query:f},_="";return _=i?"/facets/".concat(this.filter.metadatum.metadatum_id,"?getSelected=").concat(m,"&"):"default"==this.filter.collection_id&&this.currentCollectionId?"/collection/".concat(this.currentCollectionId,"/facets/").concat(this.filter.metadatum.metadatum_id,"?getSelected=").concat(m,"&"):"/collection/".concat(this.filter.collection_id,"/facets/").concat(this.filter.metadatum.metadatum_id,"?getSelected=").concat(m,"&"),_+=null!=l&&null!=r?"offset=".concat(l,"&number=").concat(r):"nopaging=1",a&&(_+="&search=".concat(a)),null!=d&&!1===d&&(_+="&count_items=0"),this.isLoadingOptions=!0,new Object({request:new Promise((function(t,i){o.Ay.tainacanApi.get(_+"&"+n().stringify(g)).then((function(i){e.isLoadingOptions=!1,i.data.values?e.prepareOptionsForRelationship(i.data.values,a,s,c):e.prepareOptionsForRelationship(i.data,a,s,c),t(i)})).catch((function(t){o.Ay.isCancel(t)?console.log("Request canceled: ",t.message):e.isLoadingOptions=!1,i(t)}))})),source:p})}var b=new Promise((function(t){for(var i in e.facetsFromItemSearch)i==e.filter.id&&(e.prepareOptionsForRelationship(e.facetsFromItemSearch[i],a,s,c),e.$emit("update-parent-collapse",e.facetsFromItemSearch[i].length>0));t()}));return new Object({request:b})},prepareOptionsForPlainText:function(t,e,a,i){var n=[],o=[];Array.isArray(t)||(t=Object.values(t));var s,l=r(t);try{var c=function(){var t=s.value;if(null!=a&&a.length>0){var l=a.findIndex((function(e){return e==t.value}));e&&i?n.push({label:t.label,value:t.value,total_items:t.total_items}):l<0&&o.push({label:t.label,value:t.value,total_items:t.total_items})}else e&&i?n.push({label:t.label,value:t.value,total_items:t.total_items}):o.push({label:t.label,value:t.value,total_items:t.total_items})};for(l.s();!(s=l.n()).done;)c()}catch(t){l.e(t)}finally{l.f()}if(!0===this.shouldAddOptions&&this.searchResults&&this.searchResults.length?this.searchResults=this.searchResults.concat(n):this.searchResults=n,o?!0===this.shouldAddOptions&&this.options&&this.options.length?this.options=this.options.concat(o):this.options=o:e||(this.noMorePage=1),this.options.length<this.maxNumOptionsCheckboxList&&!e&&(this.noMorePage=1),this.filter.filter_type_object&&1==this.filter.filter_type_object.use_max_options&&this.filter.max_options&&this.options.length>=this.filter.max_options){var u=!0;this.options.length===this.filter.max_options?this.options[this.filter.max_options-1].showViewAllButton=u:this.options[this.options.length-1].showViewAllButton=u}},prepareOptionsForRelationship:function(t,e,a,i){var n=this,o=[],s=[];if(t.length>0){var l,c=r(t);try{var u=function(){var t=l.value;if(null!=a&&a.length>0){var r=a.findIndex((function(e){return e==t.value}));e&&i?o.push({label:t.label,value:t.value,img:t.thumbnail?n.$thumbHelper.getSrc(t.thumbnail,"tainacan-small"):t.img?t.img:"",total_items:t.total_items}):r<0&&s.push({label:t.label,value:t.value,img:t.thumbnail?n.$thumbHelper.getSrc(t.thumbnail,"tainacan-small"):t.img?t.img:"",total_items:t.total_items})}else e&&i?o.push({label:t.label,value:t.value,img:t.thumbnail?n.$thumbHelper.getSrc(t.thumbnail,"tainacan-small"):t.img?t.img:"",total_items:t.total_items}):s.push({label:t.label,value:t.value,img:t.thumbnail?n.$thumbHelper.getSrc(t.thumbnail,"tainacan-small"):t.img?t.img:"",total_items:t.total_items})};for(c.s();!(l=c.n()).done;)u()}catch(t){c.e(t)}finally{c.f()}}if(!0===this.shouldAddOptions&&this.searchResults&&this.searchResults.length?this.searchResults=this.searchResults.concat(o):this.searchResults=o,s?!0===this.shouldAddOptions&&this.options&&this.options.length?this.options=this.options.concat(s):this.options=s:e||(this.noMorePage=1),this.options.length<this.maxNumOptionsCheckboxList&&(this.noMorePage=1),this.filter.filter_type_object&&1==this.filter.filter_type_object.use_max_options&&this.filter.max_options&&this.options.length>=this.filter.max_options){var m=!0;this.options.length===this.filter.max_options?this.options[this.filter.max_options-1].showViewAllButton=m:this.options[this.options.length-1].showViewAllButton=m}}},beforeUnmount:function(){null!=this.getOptionsValuesCancel&&this.getOptionsValuesCancel.cancel("Facet search Canceled.")}}},11685:(t,e,a)=>{a.r(e),a.d(e,{default:()=>o});var i=a(54235),n=a(53294);const o=(0,a(66262).A)(n.A,[["render",i.X]])},53294:(t,e,a)=>{a.d(e,{A:()=>i.A});var i=a(49515)},54235:(t,e,a)=>{a.d(e,{X:()=>i.X});var i=a(36054)}}]);