"use strict";(self.webpackChunktainacan=self.webpackChunktainacan||[]).push([[8571],{2169:(t,e,i)=>{i.d(e,{A:()=>l});var n=i(55373),a=i.n(n),o=i(75552);function s(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=function(t,e){if(t){if("string"==typeof t)return r(t,e);var i={}.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?r(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var _n=0,n=function(){};return{s:n,n:function(){return _n>=t.length?{done:!0}:{done:!1,value:t[_n++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==i.return||i.return()}finally{if(s)throw a}}}}function r(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=Array(e);i<e;i++)n[i]=t[i];return n}const l={mixins:[i(8926).s],emits:["input"],data:function(){return{isLoadingOptions:!1,results:"",selected:[],options:[],taxonomy:"",taxonomyId:"",searchQuery:"",totalFacets:0,offset:0}},watch:{isLoadingItems:{handler:function(){this.isLoadingOptions=this.isLoadingItems},immediate:!0},query:{handler:function(){this.updateSelectedValues()},deep:!0}},created:function(){this.filter.metadatum&&this.filter.metadatum.metadata_type_object&&this.filter.metadatum.metadata_type_object.options&&this.filter.metadatum.metadata_type_object.options.taxonomy&&this.filter.metadatum.metadata_type_object.options.taxonomy_id&&(this.taxonomyId=this.filter.metadatum.metadata_type_object.options.taxonomy_id,this.taxonomy=this.filter.metadatum.metadata_type_object.options.taxonomy)},mounted:function(){this.updateSelectedValues()},methods:{performSearch:function(t){var e=this;if(t!=this.searchQuery&&(this.searchQuery=t,this.options=[],this.offset=0),t.length||(this.searchQuery=t,this.options=[],this.offset=0),!(this.offset>0&&this.options.length>=this.totalFacets)){this.isLoadingOptions=!0;var i={current_query:this.query,search:this.searchQuery,offset:this.offset,number:12},n="";this.isRepositoryLevel?n+="/facets/"+this.metadatumId:"default"==this.filter.collection_id&&this.currentCollectionId?n+="/collection/"+this.currentCollectionId+"/facets/"+this.metadatumId:n+="/collection/"+this.filter.collection_id+"/facets/"+this.metadatumId,n+="?order=asc&"+a().stringify(i);var r=JSON.parse(JSON.stringify(this.selected));return o.UY.get(n).then((function(i){var n,a=s(i.data.values);try{var o=function(){var i=n.value;null!=r&&r.length>0?r.findIndex((function(t){return t==i.value}))<0&&i.label.toLowerCase().indexOf(t.toLowerCase())>=0&&e.options.push({label:i.label,value:i.value,total_items:i.total_items}):i.label.toLowerCase().indexOf(t.toLowerCase())>=0&&e.options.push({label:i.label,value:i.value,total_items:i.total_items})};for(a.s();!(n=a.n()).done;)o()}catch(t){a.e(t)}finally{a.f()}e.totalFacets=i.headers["x-wp-total"],e.offset+=12,e.isLoadingOptions=!1})).catch((function(t){e.isLoadingOptions=!1,e.$console.log(t)}))}},search:_.debounce((function(t){this.performSearch(t)}),500),searchMore:_.debounce((function(){this.performSearch(this.searchQuery)}),250),updateSelectedValues:function(){var t=this;if(!this.query||!this.query.taxquery||!Array.isArray(this.query.taxquery))return!1;this.selected=[];var e=this.query.taxquery.findIndex((function(e){return e.taxonomy==t.taxonomy}));if(e>=0){var i,n=s(this.query.taxquery[e].terms);try{for(n.s();!(i=n.n()).done;){var a=i.value;this.selected.push(a)}}catch(t){n.e(t)}finally{n.f()}}},onSelect:function(t){this.$emit("input",{filter:"taginput",compare:"IN",taxonomy:this.taxonomy,metadatum_id:this.metadatumId,collection_id:this.collectionId,terms:_.union(this.selected,t.map((function(t){return t.value})))})}}}},61148:(t,e,i)=>{i.d(e,{X:()=>c});var n=i(6934),a={class:"block"},o={class:"media"},s={class:"media-content"},r={class:"ellipsed-text"},l={key:0,class:"has-text-gray"};function c(t,e,i,c,u,h){var m=(0,n.g2)("b-taginput");return(0,n.uX)(),(0,n.CE)("div",a,[(0,n.bF)(m,{size:"is-small",icon:"magnify",data:u.options,autocomplete:"","open-on-focus":!0,loading:u.isLoadingOptions,expanded:"","remove-on-keys":[],field:"label",attached:"","aria-close-label":t.$i18n.get("remove_value"),"aria-labelledby":"filter-label-id-"+t.filter.id,class:(0,n.C4)({"has-selected":null!=u.selected&&u.selected!=[]}),placeholder:t.filter.placeholder?t.filter.placeholder:t.$i18n.get("info_type_to_add_terms"),"check-infinite-scroll":"",onTyping:h.search,onFocus:e[0]||(e[0]=function(t){u.searchQuery=t.target.value,h.performSearch(u.searchQuery)}),"onUpdate:modelValue":e[1]||(e[1]=function(e){t.resetPage(),h.onSelect(e)}),onInfiniteScroll:h.searchMore},(0,n.eX)({default:(0,n.k6)((function(t){return[(0,n.Lk)("div",o,[(0,n.Lk)("div",s,[(0,n.Lk)("span",r,(0,n.v_)(t.option.label),1),null!=t.option.total_items?((0,n.uX)(),(0,n.CE)("span",l,(0,n.v_)("("+t.option.total_items+")"),1)):(0,n.Q3)("",!0)])])]})),_:2},[u.isLoadingOptions?void 0:{name:"empty",fn:(0,n.k6)((function(){return[(0,n.eW)((0,n.v_)(t.$i18n.get("info_no_options_found")),1)]})),key:"0"}]),1032,["data","loading","aria-close-label","aria-labelledby","class","placeholder","onTyping","onInfiniteScroll"])])}},8926:(t,e,i)=>{i.d(e,{F:()=>f,s:()=>m});var n=i(55373),a=i.n(n),o=i(75552),s=i(40834);function r(t){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r(t)}function l(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=function(t,e){if(t){if("string"==typeof t)return c(t,e);var i={}.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?c(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var _n=0,n=function(){};return{s:n,n:function(){return _n>=t.length?{done:!0}:{done:!1,value:t[_n++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==i.return||i.return()}finally{if(s)throw a}}}}function c(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=Array(e);i<e;i++)n[i]=t[i];return n}function u(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function h(t,e,i){return(e=function(t){var e=function(t,e){if("object"!=r(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var n=i.call(t,e||"default");if("object"!=r(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==r(e)?e:e+""}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var m={data:function(){return{collectionId:"",metadatumId:"",metadatumType:"",metadatumName:"",filterTypeOptions:[],shouldAddOptions:!1}},props:{filter:Object,query:Object,isRepositoryLevel:Boolean,isUsingElasticSearch:Boolean,isLoadingItems:Boolean,currentCollectionId:[Number,String]},created:function(){this.collectionId=this.filter.collection_id?this.filter.collection_id:this.collectionId,this.metadatumId=this.filter.metadatum.metadatum_id?this.filter.metadatum.metadatum_id:this.metadatumId,this.metadatumName=this.filter.metadatum&&this.filter.metadatum.metadatum_name?this.filter.metadatum.metadatum_name:this.metadatumName,this.filterTypeOptions=this.filter.filter_type_options?this.filter.filter_type_options:this.filterTypeOptions,this.metadatumType=this.filter.metadatum.metadata_type_object&&this.filter.metadatum.metadata_type_object.className?this.filter.metadatum.metadata_type_object.className:this.metadatumType},methods:{resetPage:function(){this.$eventBusSearch.resetPageOnStore()}}},f={data:function(){return{getOptionsValuesCancel:void 0,isLoadingOptions:!1,facetSearchPage:1}},emits:["update-parent-collapse"],computed:function(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?u(Object(i),!0).forEach((function(e){h(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):u(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}({},(0,s.L8)("search",{facetsFromItemSearch:"getFacets"})),watch:{isLoadingItems:{handler:function(){this.isUsingElasticSearch&&(this.isLoadingOptions=this.isLoadingItems)},immediate:!0}},methods:{getValuesPlainText:function(t){var e=this,i=t.metadatumId,n=t.search,s=t.isRepositoryLevel,r=t.valuesToIgnore,l=t.offset,c=t.number,u=t.isInCheckboxModal,h=t.getSelected,m=void 0===h?"0":h,f=t.countItems,d=void 0===f||f;if(u||n||!this.isUsingElasticSearch){var p=o.Ay.CancelToken.source(),y=JSON.parse(JSON.stringify(this.query));null!=y.fetch_only&&delete y.fetch_only;var g={current_query:y},b="";return b=s?"/facets/".concat(i,"?getSelected=").concat(m,"&"):"default"==this.filter.collection_id&&this.currentCollectionId?"/collection/".concat(this.currentCollectionId,"/facets/").concat(i,"?getSelected=").concat(m,"&"):"/collection/".concat(this.filter.collection_id,"/facets/").concat(i,"?getSelected=").concat(m,"&"),null!=l&&null!=c&&(this.isUsingElasticSearch?b+="last_term=".concat(l,"&number=").concat(c,"&"):b+="offset=".concat(l,"&number=").concat(c,"&")),b+=n&&null!=l&&null!=c||n?"search=".concat(n,"&")+a().stringify(g):a().stringify(g),null!=d&&!1===d&&(b+="&count_items=0"),this.isLoadingOptions=!0,new Object({request:new Promise((function(t,i){o.Ay.tainacanApi.get(b,{cancelToken:p.token}).then((function(i){e.isLoadingOptions=!1,i.data.values?e.prepareOptionsForPlainText(i.data.values,n,r,u):e.prepareOptionsForPlainText(i.data,n,r,u),t(i)})).catch((function(t){o.Ay.isCancel(t)?console.log("Request canceled: ",t.message):e.isLoadingOptions=!1,i(t)}))})),source:p})}var v=new Promise((function(t){for(var i in e.facetsFromItemSearch)i==e.filter.id&&(e.prepareOptionsForPlainText(e.facetsFromItemSearch[i],n,r,u),e.$emit("update-parent-collapse",e.facetsFromItemSearch[i].length>0));t()}));return new Object({request:v})},getValuesRelationship:function(t){var e=this,i=t.search,n=t.isRepositoryLevel,s=t.valuesToIgnore,r=t.offset,l=t.number,c=t.isInCheckboxModal,u=t.getSelected,h=void 0===u?"0":u,m=t.countItems,f=void 0===m||m;if(c||i||!this.facetsFromItemSearch||Object.values(this.facetsFromItemSearch).length<=0){var d=o.Ay.CancelToken.source(),p=JSON.parse(JSON.stringify(this.query));null!=p.fetch_only&&delete p.fetch_only;var y={current_query:p},g="";return g=n?"/facets/".concat(this.filter.metadatum.metadatum_id,"?getSelected=").concat(h,"&"):"default"==this.filter.collection_id&&this.currentCollectionId?"/collection/".concat(this.currentCollectionId,"/facets/").concat(this.filter.metadatum.metadatum_id,"?getSelected=").concat(h,"&"):"/collection/".concat(this.filter.collection_id,"/facets/").concat(this.filter.metadatum.metadatum_id,"?getSelected=").concat(h,"&"),g+=null!=r&&null!=l?"offset=".concat(r,"&number=").concat(l):"nopaging=1",i&&(g+="&search=".concat(i)),null!=f&&!1===f&&(g+="&count_items=0"),this.isLoadingOptions=!0,new Object({request:new Promise((function(t,n){o.Ay.tainacanApi.get(g+"&"+a().stringify(y)).then((function(n){e.isLoadingOptions=!1,n.data.values?e.prepareOptionsForRelationship(n.data.values,i,s,c):e.prepareOptionsForRelationship(n.data,i,s,c),t(n)})).catch((function(t){o.Ay.isCancel(t)?console.log("Request canceled: ",t.message):e.isLoadingOptions=!1,n(t)}))})),source:d})}var b=new Promise((function(t){for(var n in e.facetsFromItemSearch)n==e.filter.id&&(e.prepareOptionsForRelationship(e.facetsFromItemSearch[n],i,s,c),e.$emit("update-parent-collapse",e.facetsFromItemSearch[n].length>0));t()}));return new Object({request:b})},prepareOptionsForPlainText:function(t,e,i,n){var a=[],o=[];Array.isArray(t)||(t=Object.values(t));var s,r=l(t);try{var c=function(){var t=s.value;if(null!=i&&i.length>0){var r=i.findIndex((function(e){return e==t.value}));e&&n?a.push({label:t.label,value:t.value,total_items:t.total_items}):r<0&&o.push({label:t.label,value:t.value,total_items:t.total_items})}else e&&n?a.push({label:t.label,value:t.value,total_items:t.total_items}):o.push({label:t.label,value:t.value,total_items:t.total_items})};for(r.s();!(s=r.n()).done;)c()}catch(t){r.e(t)}finally{r.f()}if(!0===this.shouldAddOptions&&this.searchResults&&this.searchResults.length?this.searchResults=this.searchResults.concat(a):this.searchResults=a,o?!0===this.shouldAddOptions&&this.options&&this.options.length?this.options=this.options.concat(o):this.options=o:e||(this.noMorePage=1),this.options.length<this.maxNumOptionsCheckboxList&&!e&&(this.noMorePage=1),this.filter.filter_type_object&&1==this.filter.filter_type_object.use_max_options&&this.filter.max_options&&this.options.length>=this.filter.max_options){var u=!0;this.options.length===this.filter.max_options?this.options[this.filter.max_options-1].showViewAllButton=u:this.options[this.options.length-1].showViewAllButton=u}},prepareOptionsForRelationship:function(t,e,i,n){var a=this,o=[],s=[];if(t.length>0){var r,c=l(t);try{var u=function(){var t=r.value;if(null!=i&&i.length>0){var l=i.findIndex((function(e){return e==t.value}));e&&n?o.push({label:t.label,value:t.value,img:t.thumbnail?a.$thumbHelper.getSrc(t.thumbnail,"tainacan-small"):t.img?t.img:"",total_items:t.total_items}):l<0&&s.push({label:t.label,value:t.value,img:t.thumbnail?a.$thumbHelper.getSrc(t.thumbnail,"tainacan-small"):t.img?t.img:"",total_items:t.total_items})}else e&&n?o.push({label:t.label,value:t.value,img:t.thumbnail?a.$thumbHelper.getSrc(t.thumbnail,"tainacan-small"):t.img?t.img:"",total_items:t.total_items}):s.push({label:t.label,value:t.value,img:t.thumbnail?a.$thumbHelper.getSrc(t.thumbnail,"tainacan-small"):t.img?t.img:"",total_items:t.total_items})};for(c.s();!(r=c.n()).done;)u()}catch(t){c.e(t)}finally{c.f()}}if(!0===this.shouldAddOptions&&this.searchResults&&this.searchResults.length?this.searchResults=this.searchResults.concat(o):this.searchResults=o,s?!0===this.shouldAddOptions&&this.options&&this.options.length?this.options=this.options.concat(s):this.options=s:e||(this.noMorePage=1),this.options.length<this.maxNumOptionsCheckboxList&&(this.noMorePage=1),this.filter.filter_type_object&&1==this.filter.filter_type_object.use_max_options&&this.filter.max_options&&this.options.length>=this.filter.max_options){var h=!0;this.options.length===this.filter.max_options?this.options[this.filter.max_options-1].showViewAllButton=h:this.options[this.options.length-1].showViewAllButton=h}}},beforeUnmount:function(){null!=this.getOptionsValuesCancel&&this.getOptionsValuesCancel.cancel("Facet search Canceled.")}}},8571:(t,e,i)=>{i.r(e),i.d(e,{default:()=>o});var n=i(19965),a=i(21972);const o=(0,i(66262).A)(a.A,[["render",n.X]])},21972:(t,e,i)=>{i.d(e,{A:()=>n.A});var n=i(2169)},19965:(t,e,i)=>{i.d(e,{X:()=>n.X});var n=i(61148)}}]);